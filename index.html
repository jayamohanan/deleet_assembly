<!-- README: Version 1.5 -->
<!DOCTYPE html>
<html>
<head>
  <title>Kerala Local Bodies Map</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { margin: 0; padding: 0; }
    #map { width: 100%; height: 95vh; }
    .popup-controls {
      font-family: Arial, sans-serif;
      font-size: 13px;
    }
    .popup-controls label {
      display: block;
      margin-top: 5px;
    }
    .popup-controls input[type="color"],
    .popup-controls input[type="range"] {
      width: 100%;
    }
    .popup-controls button {
      margin-top: 8px;
      padding: 3px 6px;
      border: none;
      border-radius: 4px;
      background: #f44336;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-ajax/dist/leaflet.ajax.min.js"></script>
  <script>
    // Initialize map
    var map = L.map('map').setView([10.1, 76.2], 8);

    // Add base layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19
    }).addTo(map);

    // Style defaults
    function defaultStyle() {
      return {
        color: "#000",
        weight: 2,
        fillColor: "#3388ff",
        fillOpacity: 0.3
      };
    }

    // Function to bind popup with per-tile controls
    function bindControls(layer, feature) {
      layer.on("click", function(e) {
        var popupContent = document.createElement("div");
        popupContent.className = "popup-controls";

        // Title
        popupContent.innerHTML = "<b>" + (feature.properties.Name || "Boundary") + "</b>";

        // Color input
        var colorLabel = document.createElement("label");
        colorLabel.textContent = "Fill Color:";
        var colorInput = document.createElement("input");
        colorInput.type = "color";
        colorInput.value = layer.options.fillColor;

        // Transparency input
        var opacityLabel = document.createElement("label");
        opacityLabel.textContent = "Transparency:";
        var opacityInput = document.createElement("input");
        opacityInput.type = "range";
        opacityInput.min = 0; opacityInput.max = 1; opacityInput.step = 0.1;
        opacityInput.value = layer.options.fillOpacity;

        // Border thickness input
        var borderLabel = document.createElement("label");
        borderLabel.textContent = "Border Thickness:";
        var borderInput = document.createElement("input");
        borderInput.type = "range";
        borderInput.min = 1; borderInput.max = 10; borderInput.value = layer.options.weight;

        // Close button
        var closeBtn = document.createElement("button");
        closeBtn.textContent = "Close";
        closeBtn.onclick = function() {
          map.closePopup();
        };

        // Event listeners
        colorInput.addEventListener("input", function() {
          layer.setStyle({ fillColor: colorInput.value });
        });
        opacityInput.addEventListener("input", function() {
          layer.setStyle({ fillOpacity: opacityInput.value });
        });
        borderInput.addEventListener("input", function() {
          layer.setStyle({ weight: borderInput.value });
        });

        popupContent.appendChild(colorLabel);
        popupContent.appendChild(colorInput);
        popupContent.appendChild(opacityLabel);
        popupContent.appendChild(opacityInput);
        popupContent.appendChild(borderLabel);
        popupContent.appendChild(borderInput);
        popupContent.appendChild(closeBtn);

        layer.bindPopup(popupContent).openPopup(e.latlng);
      });
    }

    // Load district boundaries
    var districts = new L.GeoJSON.AJAX("district_V15.geojson", {
      style: defaultStyle,
      onEachFeature: bindControls
    }).addTo(map);

    // Load assembly boundaries (on top of districts)
    var assemblies = new L.GeoJSON.AJAX("assembly_V15.geojson", {
      style: defaultStyle,
      onEachFeature: bindControls
    }).addTo(map);

  </script>
</body>
</html>
