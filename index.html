<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kerala Administrative Divisions</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha20-bLeWqB5m/uM1v9i8tXn4+t3E5V/2xK+2+X4tP2d5r+g=" crossorigin="" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-search@2.9.8/dist/leaflet-search.min.css" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        #map {
            flex-grow: 1;
        }

        #version-info {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background-color: white;
            padding: 5px 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            font-size: 0.8em;
        }

        .controls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .control-panel {
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 5px;
        }

        .control-panel h3 {
            margin-top: 0;
            font-size: 1.1em;
        }

        .input-group {
            margin-bottom: 10px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        select,
        input[type="color"],
        input[type="range"],
        button {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }

        button {
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>

<body>
    <div id="version-info">Version: 1.0.0</div>
    <div id="map"></div>
    <div class="controls">
        <div class="control-panel" id="district-panel">
            <h3>Districts</h3>
            <div class="input-group">
                <label for="district-select">Select District:</label>
                <select id="district-select" multiple="multiple"></select>
            </div>
            <div class="input-group">
                <label for="district-color">Boundary Color:</label>
                <input type="color" id="district-color" value="#000000">
            </div>
            <div class="input-group">
                <label for="district-transparency">Fill Transparency:</label>
                <input type="range" id="district-transparency" min="0" max="1" step="0.01" value="1">
            </div>
            <button id="draw-district">Draw</button>
            <button id="clear-district">Clear</button>
        </div>

        <div class="control-panel" id="assembly-panel">
            <h3>Assemblies</h3>
            <div class="input-group">
                <label for="assembly-select">Select Assembly:</label>
                <select id="assembly-select" multiple="multiple"></select>
            </div>
            <div class="input-group">
                <label for="assembly-color">Boundary Color:</label>
                <input type="color" id="assembly-color" value="#000000">
            </div>
            <div class="input-group">
                <label for="assembly-transparency">Fill Transparency:</label>
                <input type="range" id="assembly-transparency" min="0" max="1" step="0.01" value="1">
            </div>
            <button id="draw-assembly">Draw</button>
            <button id="clear-assembly">Clear</button>
        </div>

        <div class="control-panel">
            <h3>Base Maps</h3>
            <div class="input-group">
                <label for="base-map-select">Select Base Map:</label>
                <select id="base-map-select">
                    <option value="osm">OpenStreetMap</option>
                    <option value="none">None</option>
                    </select>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha20-z9w8+0pB8n/fPzJ7Qe3z6rF09w+P7k7r+G9/r+G9/r+w/g=" crossorigin=""></script>
    <script src="https://unpkg.com/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://unpkg.com/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <link href="https://unpkg.com/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

    <script>
        const version = "1.0.0";
        document.getElementById('version-info').innerText = `Version: ${version}`;

        const map = L.map('map').setView([10.8505, 76.2711], 8);

        const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        let currentBaseMap = osmLayer;

        const baseMapSelect = document.getElementById('base-map-select');
        baseMapSelect.addEventListener('change', (e) => {
            if (currentBaseMap) {
                map.removeLayer(currentBaseMap);
            }
            if (e.target.value === 'osm') {
                currentBaseMap = osmLayer.addTo(map);
            } else if (e.target.value === 'none') {
                currentBaseMap = null;
            }
        });

        const drawnLayers = {
            district: L.geoJSON().addTo(map),
            assembly: L.geoJSON().addTo(map)
        };

        const geojsonCache = {};

        async function loadGeoJSON(type) {
            if (geojsonCache[type]) {
                return geojsonCache[type];
            }
            try {
                const response = await fetch(`${type}_V15.geojson`);
                const data = await response.json();
                geojsonCache[type] = data;
                return data;
            } catch (error) {
                console.error(`Error loading GeoJSON for ${type}:`, error);
                return null;
            }
        }

        function setupSelect2(selectId, data) {
            $(`#${selectId}`).select2({
                data: data.features.map(f => ({
                    id: f.properties.Name,
                    text: f.properties.Name
                })),
                placeholder: 'Search and select...',
                allowClear: true
            });
        }

        async function init() {
            const districtData = await loadGeoJSON('district');
            if (districtData) {
                setupSelect2('district-select', districtData);
            }

            const assemblyData = await loadGeoJSON('assembly');
            if (assemblyData) {
                setupSelect2('assembly-select', assemblyData);
            }
        }

        function getStyle(color, transparency) {
            return {
                fillColor: color,
                weight: 2,
                opacity: 1,
                color: 'black',
                fillOpacity: transparency
            };
        }

        function drawBoundaries(type) {
            const selectElement = document.getElementById(`${type}-select`);
            const selectedNames = $(`#${type}-select`).val();
            const color = document.getElementById(`${type}-color`).value;
            const transparency = document.getElementById(`${type}-transparency`).value;
            const geojson = geojsonCache[type];

            if (!geojson || !selectedNames || selectedNames.length === 0) {
                return;
            }

            const featuresToDraw = geojson.features.filter(f => selectedNames.includes(f.properties.Name));

            drawnLayers[type].clearLayers();
            L.geoJSON(featuresToDraw, {
                style: () => getStyle(color, transparency)
            }).addTo(drawnLayers[type]);
        }

        document.getElementById('draw-district').addEventListener('click', () => drawBoundaries('district'));
        document.getElementById('draw-assembly').addEventListener('click', () => drawBoundaries('assembly'));

        document.getElementById('clear-district').addEventListener('click', () => drawnLayers.district.clearLayers());
        document.getElementById('clear-assembly').addEventListener('click', () => drawnLayers.assembly.clearLayers());

        init();
    </script>
</body>

</html>
