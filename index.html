<!-- district-map.html with assembly option -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>District & Assembly Map Drawer</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html,body{height:100%;margin:0;font-family:system-ui,Arial}
    #app{display:flex;flex-direction:column;height:100%}
    header{padding:12px;background:#0b5;display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    input[type=text]{padding:8px;border-radius:6px;border:1px solid #ccc;min-width:180px}
    button{padding:8px 12px;border-radius:6px;border:none;background:#075;color:white;cursor:pointer}
    #status{margin-left:8px;font-size:0.95rem;color:#080}
    #map{flex:1}
    #note{padding:6px 12px;color:#900;white-space:pre-line}
  </style>
</head>
<body>
  <div id="app">
    <header>
      <div>
        <label for="districtInput">District:</label>
        <input id="districtInput" list="districtList" placeholder="District name">
        <datalist id="districtList"></datalist>
        <button id="drawDistrictBtn">Draw District</button>
      </div>
      <div>
        <label for="assemblyInput">Assembly:</label>
        <input id="assemblyInput" list="assemblyList" placeholder="Assembly name">
        <datalist id="assemblyList"></datalist>
        <button id="drawAssemblyBtn">Draw Assembly</button>
      </div>
      <div id="status"></div>
    </header>
    <div id="map"></div>
    <div id="note"></div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const DISTRICT_URL = 'district12_V3.geojson';
    const ASSEMBLY_URL = 'assembly12_V3.geojson';

    const map = L.map('map', {minZoom: 6}).setView([10.85, 76.27], 7);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    let geoDistrict = null;
    let geoAssembly = null;
    let currentLayer = null;

    const districtInput = document.getElementById('districtInput');
    const districtList = document.getElementById('districtList');
    const drawDistrictBtn = document.getElementById('drawDistrictBtn');

    const assemblyInput = document.getElementById('assemblyInput');
    const assemblyList = document.getElementById('assemblyList');
    const drawAssemblyBtn = document.getElementById('drawAssemblyBtn');

    const status = document.getElementById('status');
    const note = document.getElementById('note');

    function logMessage(msg, isError=false){
      note.style.color = isError ? '#900' : '#060';
      note.textContent = msg;
    }

    status.textContent = 'Loading GeoJSON...';

    Promise.all([
      fetch(DISTRICT_URL).then(r=>r.json()),
      fetch(ASSEMBLY_URL).then(r=>r.json())
    ]).then(([djson,ajson])=>{
      geoDistrict = djson;
      geoAssembly = ajson;
      status.textContent = 'GeoJSON loaded.';
      populateDatalist(geoDistrict,districtList);
      populateDatalist(geoAssembly,assemblyList);
    }).catch(err=>{
      logMessage('Error loading geojson: '+err.message,true);
      console.error(err);
    });

    const LIKELY_NAME_KEYS = ['NAME','Name','name','DISTRICT','District','district','DISTRICT_NAME','DIST_NAME','NAME_1','AC_NAME','ACNAME'];

    function getFeatureName(feature){
      if(!feature || !feature.properties) return null;
      for(const k of LIKELY_NAME_KEYS){
        if(k in feature.properties){
          const v = feature.properties[k];
          if(typeof v === 'string' && v.trim().length>0) return v.trim();
        }
      }
      for(const k in feature.properties){
        const v = feature.properties[k];
        if(typeof v === 'string' && v.trim().length>0) return v.trim();
      }
      return null;
    }

    function populateDatalist(geojson, listElem){
      const names = new Set();
      if(!geojson.features) return;
      for(const f of geojson.features){
        const n = getFeatureName(f);
        if(n) names.add(n);
      }
      Array.from(names).sort().forEach(n=>{
        const opt=document.createElement('option');
        opt.value=n;
        listElem.appendChild(opt);
      });
    }

    function highlightFeatures(query, geojson, label){
      if(!geojson){ logMessage(label+' GeoJSON not loaded.',true); return; }
      if(currentLayer) map.removeLayer(currentLayer);

      const matched = geojson.features.filter(f => {
        const n = getFeatureName(f);
        return n && n.toLowerCase() === query.toLowerCase();
      });

      if(matched.length === 0){
        logMessage('No '+label+' found for: '+query,true);
        return;
      }

      currentLayer = L.geoJSON(matched, {
        style: {color: '#cc3300', weight: 2, fillColor: '#ff9966', fillOpacity: 0.45},
        onEachFeature: (feature, layer)=>{
          const n = getFeatureName(feature) || 'Unknown';
          layer.bindPopup('<b>'+label+': '+n+'</b>');
        }
      }).addTo(map);

      map.fitBounds(currentLayer.getBounds().pad(0.1));
      logMessage('Highlighted '+label+': '+query);
    }

    drawDistrictBtn.addEventListener('click',()=>{
      const q=districtInput.value.trim();
      if(!q){ logMessage('Enter a district name.',true); return; }
      highlightFeatures(q,geoDistrict,'District');
    });

    drawAssemblyBtn.addEventListener('click',()=>{
      const q=assemblyInput.value.trim();
      if(!q){ logMessage('Enter an assembly name.',true); return; }
      highlightFeatures(q,geoAssembly,'Assembly');
    });

    districtInput.addEventListener('keydown',e=>{if(e.key==='Enter')drawDistrictBtn.click();});
    assemblyInput.addEventListener('keydown',e=>{if(e.key==='Enter')drawAssemblyBtn.click();});

    if(location.protocol==='file:'){
      logMessage('Tip: run a local server (python -m http.server) if geojson fails to load.',false);
    }
  </script>
</body>
</html>
